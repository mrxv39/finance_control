<!DOCTYPE html>
<html lang="es">
  {% include "partials/head.html" %}
<body>

  {% include "partials/topbar.html" %}

  <main class="app-container">

    <!-- ONBOARDING MODAL FOR FIRST-TIME USERS -->
    {% if needs_onboarding %}
    <div id="onboardingModal" class="onboarding-modal">
      <div class="onboarding-modal-content">
        <button class="onboarding-modal-close" onclick="closeOnboardingModal()" aria-label="Cerrar">&times;</button>
        
        <div class="onboarding-modal-body">
          <h2 class="onboarding-title">üëã Bienvenido</h2>
          
          <div id="onboardingMainContent">
            <p class="onboarding-text">
              Vamos a conocernos mejor.
            </p>
            <p class="onboarding-text">
              Para empezar, ve a tu banco y exporta un CSV con tus movimientos del √∫ltimo a√±o.
            </p>
            <p class="onboarding-text">
              Solo necesitamos estas columnas:
            </p>
            <ul class="onboarding-list">
              <li>Fecha</li>
              <li>Descripci√≥n</li>
              <li>Importe</li>
            </ul>
            <p class="onboarding-text">
              Si no conoces la categor√≠a de cada gasto, no te preocupes.<br>
              Yo te ayudar√© a categorizar.
            </p>
            
            <div class="onboarding-actions">
              <a href="/import" class="onboarding-btn-primary">üìÇ Subir mi CSV</a>
              <button type="button" class="onboarding-btn-secondary" onclick="showWhyInfo()">
                ¬øPor qu√© quieres esta informaci√≥n?
              </button>
            </div>
          </div>
          
          <div id="onboardingInfoContent" style="display:none;">
            <p class="onboarding-text">
              Analizaremos tus gastos e ingresos para entender tus h√°bitos financieros.
              Con esta informaci√≥n podr√© ayudarte a clasificar tus movimientos
              y m√°s adelante dise√±ar un presupuesto personalizado adaptado a ti.
            </p>
            <p class="onboarding-text">
              No pasa nada si los datos no est√°n perfectos.
            </p>
            
            <div class="onboarding-actions">
              <button type="button" class="onboarding-btn-primary" onclick="hideWhyInfo()">
                Entendido
              </button>
            </div>
          </div>
        </div>
        
        <button type="button" class="onboarding-btn-dismiss" onclick="closeOnboardingModal()">
          Ahora no
        </button>
      </div>
    </div>
    {% endif %}

    <!-- ERRORES -->
    <div id="errorBox" class="auth-alert" style="display:none;"></div>

    {% include "partials/filters.html" %}
    {% include "partials/summary.html" %}
    {% include "partials/form_gasto.html" %}
    {% include "partials/table_gastos.html" %}

  </main>

  <!-- JS modular -->
  <script type="module" src="{{ url_for('static', filename='app.js') }}"></script>
  
  <!-- Onboarding modal scripts -->
  <script>
    // Auto-show onboarding modal on page load
    window.addEventListener('DOMContentLoaded', function() {
      const modal = document.getElementById('onboardingModal');
      if (modal) {
        modal.style.display = 'flex';
      }
    });
    
    function closeOnboardingModal() {
      const modal = document.getElementById('onboardingModal');
      if (modal) {
        modal.style.display = 'none';
      }
    }
    
    function showWhyInfo() {
      document.getElementById('onboardingMainContent').style.display = 'none';
      document.getElementById('onboardingInfoContent').style.display = 'block';
    }
    
    function hideWhyInfo() {
      document.getElementById('onboardingMainContent').style.display = 'block';
      document.getElementById('onboardingInfoContent').style.display = 'none';
    }
    
    // Close modal when clicking outside the content
    window.onclick = function(event) {
      const modal = document.getElementById('onboardingModal');
      if (event.target === modal) {
        closeOnboardingModal();
      }
    }
  </script>
</body>
</html>
